version: "3"

tasks:
  build:
    desc: Build the application
    cmds:
      - go build -o ./build/cron-server{{exeExt}} .

  run:
    desc: Run the application
    deps: [build]
    cmds:
      - ./build/cron-server{{exeExt}}
    env:
      PORT: '{{.PORT | default "8080"}}'
      SUPER_ADMIN_KEY: '{{.SUPER_ADMIN_KEY | default "super_admin_key"}}'
      CONFIG_FILE_PATH: '{{.CONFIG_FILE_PATH | default "./config/config.json"}}'
      AUTO_SAVE_INTERVAL: '{{.AUTO_SAVE_INTERVAL | default "60"}}'

  test:
    desc: Run tests
    cmds:
      - go test -v ./...

  clean:
    desc: Clean build artifacts
    cmds:
      - rm -f cron-server

  docker-build:
    desc: Build Docker image
    cmds:
      - docker build -t cron-server .

  docker-run:
    desc: Run Docker container
    deps: [docker-build]
    cmds:
      - >
        docker run -p {{.PORT | default "8080"}}:8080
        -e PORT=8080
        -e SUPER_ADMIN_KEY={{.SUPER_ADMIN_KEY | default "super_admin_key"}}
        -e CONFIG_FILE_PATH={{.CONFIG_FILE_PATH | default "/config/config.json"}}
        -e AUTO_SAVE_INTERVAL={{.AUTO_SAVE_INTERVAL | default "60"}}
        -v {{.PWD}}/config:/config
        cron-server

  docker-compose-up:
    desc: Run with Docker Compose
    cmds:
      - docker-compose up -d

  docker-compose-down:
    desc: Stop Docker Compose services
    cmds:
      - docker-compose down
